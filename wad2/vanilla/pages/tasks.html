<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.3.2/main.min.css">
    <link href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.1/css/all.css' rel='stylesheet'>
    <style>
        body {
            background-image: url("../assets/bg.jpg");
            background-size: cover;
            background-repeat: no-repeat;
        }

        #tasks {
            height: 100%;
            margin-bottom: 80px;
        }

        #exp {
            margin-top: -15px;
        }

        #lvl {
            margin-top: -15px;
        }

        #ch-container {
            width: 80%;
        }

        .fc-daygrid-day {
            padding: 40px;
            background-color: #fff2d6;
        }

        #ch-window {
            width: 100%;
            height: 100%;
            border: 5px solid #a8c582;
            background: url("../assets/ch-bg.png") repeat-x right center;
            background-size: 150px;
            -webkit-animation: displace 10s linear infinite;
            animation: displace 10s linear infinite;
        }

        @-webkit-keyframes displace {

            from {
                background-position: 200% center;
            }

            to {
                background-position: right center;
            }


        }

        @keyframes displace {
            from {
                background-position: 200% center;
            }

            to {
                background-position: right center;
            }
        }


        #ch-img {
            width: 100px;
            margin-top: 10px;
            margin-left: 10px;
        }

        #demon {
            width: 110px;
            margin-top: 10px;
            margin-left: 100px;
        }

        #lvl-container {
            width: 150px;
            padding: 0px;
        }

        #lvl-window {
            border: 5px solid #a8c582;
            border-right: none;
        }

        #sidebar {
            border: 5px solid #a8c582;
        }

        #sidebar button {
            font-size: 13px;
        }

        .sidebar-btn {
            margin: 5px 0px;
            width: 120px;
        }

        #gantt-chart,
        #calendar-col {
            border: 5px solid #a8c582;
            height: 420px;
        }

        #meeting-list {
            border: 5px solid #a8c582;
            height: 420px;
            padding: 20px;
        }

        #chart_div {
            margin: 30px 0px;
            background: transparent;
            /* width: 700px; */
        }

        .meeting-header-th {
            border-bottom: 2px solid #007bff !important;
        }

        .meeting-row {
            border-top: 1px solid #007bff !important;
        }

        @media (max-width: 767.98px) {

            #demon {
                margin-left: 20px;
            }

            .fc-toolbar-title {
                width: 210%;
                position: relative;
                top: -15px;
            }

            .fc-today-button {
                top: 60px;
                margin-bottom: 15px;
                position: relative;
                left: -100%;
            }

            .fc-toolbar-chunk .btn-group {
                position: relative;
                top: -50%;
            }

            #ch-window {
                width: 100%;
                height: 100%;
                border: 5px solid #a8c582;
                background: url("../assets/ch-bg.png") repeat-x right center;
                background-size: 150px;
                -webkit-animation: displace 10s linear infinite;
                animation: displace 3s linear infinite;
            }
        }

        #snackbar {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 2px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 30px;
            font-size: 17px;
        }

        #snackbar.show {
            visibility: visible;
            -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @-webkit-keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @-webkit-keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }

        @keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }

        #attackModal .modal-body {
            background-image: url("../assets/wall.png");
            height: 200px;
        }

        #attack {
            position: absolute;
            left: 50%;
            z-index: 100;
        }

        #demon2 {
            position: absolute;
            left: 50%;
        }

        #task-complete {
            color: white;
            width: 40%;
            position: absolute;
            top: 80px;
            left: 50px;
        }

        @media (max-width: 767.98px) {
            #attack {
                position: absolute;
                left: 35%;
                z-index: 100;
            }

            #demon2 {
                position: absolute;
                left: 35%;
            }

            #task-complete {
                top: 60px;
                width: 50%;
                z-index: 10000;
            }
        }
    </style>
</head>

<body>

    <div id="tasks">

        <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="taskModal"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Create New Task</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to complete this task?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-warning" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-success" v-on:click="openCompleteTaskModal"
                            data-dismiss="modal">Confirm</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="attackModal" tabindex="-1" role="dialog" aria-labelledby="attackModal"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-body">
                        <div id="task-complete">
                            <h4>Task Completed! Great job!</h4>
                        </div>
                        <canvas id="attack" width="150" height="150"></canvas>
                        <canvas id="demon2" width="150" height="150"></canvas>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" v-on:click="completeTask"
                            data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODIFY TASK MODAL-->
        <div class="modal fade" id="modTaskModal" tabindex="-1" role="dialog" aria-labelledby="modTaskModal"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Modify New Task</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Task Name</span>
                                </div>
                                <input v-model="chosenTask.taskName" type="text" class="form-control" placeholder="Name"
                                    aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Category</span>
                                </div>
                                <input v-model="chosenTask.category" type="text" class="form-control" placeholder="Name"
                                    aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Start Date</span>
                                </div>
                                <input v-model="chosenTask.start" type="text" class="form-control" id="date" name="date"
                                    placeholder="MM/DD/YYY" aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">End Date</span>
                                </div>
                                <input v-model="chosenTask.end" type="text" class="form-control" id="date" name="date"
                                    placeholder="MM/DD/YYY" aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Priority</label>
                                </div>
                                <select v-model="chosenTask.priority" class="custom-select" id="inputGroupSelect01">
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Assigned To</label>
                                </div>
                                <select v-model="chosenTask.assignedTo" class="custom-select" multiple
                                    id="inputGroupSelect01">
                                    <option v-for="user in guild.users" v-bind:id="user[1]" v-bind:value="user[1]">
                                        {{user[0]}}</option>
                                </select>
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Dependency</span>
                                </div>
                                <select v-model="chosenTask.dependency" class="custom-select" id="inputGroupSelect01">
                                    <option value="none">None</option>
                                    <option v-for="task in tasks.tasks" v-bind:id="task['id']"
                                        v-bind:value="task['id']">{{task["name"]}}
                                        [{{new Date(task["end"]).toLocaleDateString()}}]</option>
                                </select>
                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" v-on:click="modifyTask" data-dismiss="modal">Save
                            Changes</button>
                        <button v-if="chosenTask.status == false" type="button" class="btn btn-primary"
                            data-target="#confirmModal" data-toggle="modal" data-dismiss="modal">Complete Task</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADD TASK MODAL -->
        <div class="modal fade" id="taskModal" tabindex="-1" role="dialog" aria-labelledby="taskModal"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Create New Task</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Task Name</span>
                                </div>
                                <input v-model="tasks.taskName" type="text" class="form-control" placeholder="Name"
                                    aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Category</span>
                                </div>
                                <input v-model="tasks.category" type="text" class="form-control" placeholder="Name"
                                    aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Start Date</span>
                                </div>
                                <input v-model="tasks.start" type="text" class="form-control" id="date" name="date"
                                    placeholder="MM/DD/YYYY" aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">End Date</span>
                                </div>
                                <input v-model="tasks.end" type="text" class="form-control" id="date" name="date"
                                    placeholder="MM/DD/YYYY" aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Priority</label>
                                </div>
                                <select v-model="tasks.priority" class="custom-select" id="inputGroupSelect01">
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Assigned To</label>
                                </div>
                                <select v-model="tasks.assignedTo" class="custom-select" multiple
                                    id="inputGroupSelect01">
                                    <option v-for="user in guild.users" v-bind:id="user[1]">{{user[0]}}</option>
                                </select>
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Dependency</span>
                                </div>
                                <select v-model="tasks.dependency" class="custom-select" id="inputGroupSelect01">
                                    <option v-for="task in tasks.tasks" v-bind:value="task['id']">{{task["name"]}}
                                        [{{new Date(task["end"]).toLocaleDateString()}}]</option>
                                </select>
                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" v-on:click="addTask" data-dismiss="modal">Save
                            changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADD MEETING MODAL -->
        <div class="modal fade" id="meetingModal" tabindex="-1" role="dialog" aria-labelledby="meetingModal"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Create New Meeting</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Meeting Name</span>
                                </div>
                                <input v-model="meeting.name" type="text" class="form-control"
                                    placeholder="Meeting Name" aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Start Datetime</span>
                                </div>
                                <input v-model="meeting.start" type="text" class="form-control" id="date" name="date"
                                    placeholder="MM/DD/YYYY HH:SS" aria-label="Username"
                                    aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">End Datetime</span>
                                </div>
                                <input v-model="meeting.end" type="text" class="form-control" id="date" name="date"
                                    placeholder="MM/DD/YYYY HH:SS" aria-label="Username"
                                    aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Attendees</label>
                                </div>
                                <select class="custom-select" multiple id="inputGroupSelect01">
                                    <option selected>None</option>
                                    <option value="1">One</option>
                                    <option value="2">Two</option>
                                    <option value="3">Three</option>
                                </select>
                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" v-on:click="addMeeting" class="btn btn-primary">Submit</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- NAVBAR -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="#">WAD</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item ">
                        <a class="nav-link" href="./home.html">Home </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link active" href="./tasks.html">Tasks </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="./team.html">Team <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="./user.html">User</a>
                    </li>
                </ul>

                <ul class='navbar-nav ml-auto'>
                    <li class="nav-item m-1">
                        <a class="btn btn-secondary" @click='logout()'>Logout</a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- MAIN CONTENT -->
        <div class="container" style="height: 100%;">
            <br>

            <div class="row justify-content-md-center">
                <!-- CHARACTER INFO CONTAINER -->
                <div class="col-lg-2 text-center py-3" id="lvl-window">
                    <h5>Streak: {{guild.streak}} days</h5>
                    <h1 id="lvl" class="font-weight-bold">Lvl: {{user.userLevel}}</h1>
                    <h4 id="exp">EXP: {{user.userExp}}</h4>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" v-bind:style="{width: user.userExp + '%'}"
                            v-bind:aria-valuenow="user.userExp" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <!-- CHARACTER RUNNING CONTAINER -->
                <div class="col-lg-10 p-0">
                    <div class="col" id="ch-window">
                        <canvas id="ch-img" width="150" height="150"></canvas>
                        <canvas id="demon" width="150" height="150"></canvas>
                    </div>
                </div>
            </div>
            <br>

            <div class="row justify-content-md-center">
                <!-- BUTTON SIDEBAR -->
                <div class="col-lg-2 py-3 text-center" id="sidebar">
                    <button class="btn btn-warning sidebar-btn shadow-sm" v-on:click="toggleView('meetings')">View
                        {{nextView}}</button>
                    <button class="btn btn-warning sidebar-btn shadow-sm" v-on:click="toggleTaskView">View:
                        {{taskView}}</button>
                    <button class="btn btn-primary sidebar-btn shadow-sm" data-target="#taskModal"
                        data-toggle="modal">Add Task</button>
                    <button class="btn btn-primary sidebar-btn shadow-sm" data-target="#meetingModal"
                        data-toggle="modal">Add Meeting</button>
                </div>

                <!-- GANTT CHART -->
                <div class="col-lg-10" id="gantt-chart" style="overflow: scroll;">
                    <div class="container">
                        <div class="row">
                            <div class="col text-center mt-2" :key="viewKey">
                                <div id="gantt_div"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-10" id="calendar-col" style="overflow: scroll; display: none;">
                    <div class="container">
                        <div class="row">
                            <div class="col text-center mt-2" :key="viewKey">
                                <div id="calendar_div"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-10" id="meeting-list" style="overflow: scroll; display: none;">
                    <div class="container">
                        <div class="row">
                            <ul class="w-100 nav nav-fill nav-pills mb-3" id="pills-tab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="pills-upcoming-tab" data-toggle="pill"
                                        href="#pills-upcoming" role="tab" aria-controls="pills-upcoming"
                                        aria-selected="true">Upcoming meetings</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="pills-past-tab" data-toggle="pill" href="#pills-past"
                                        role="tab" aria-controls="pills-past" aria-selected="false">Past meetings</a>
                                </li>
                            </ul>

                            <div class="tab-content w-100" id="pills-tabContent">
                                <div class="tab-pane fade show active" id="pills-upcoming" role="tabpanel"
                                    aria-labelledby="pills-upcoming-tab">
                                    <div v-if="upcoming_meetings.show" class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr class="table-primary">
                                                    <th class="meeting-header-th meeting-row" scope="col">#</th>
                                                    <th class="meeting-header-th meeting-row" scope="col">Start datetime
                                                    </th>
                                                    <th class="meeting-header-th meeting-row" scope="col">Meeting</th>
                                                    <th class="meeting-header-th meeting-row" scope="col">Organizer</th>
                                                    <th class="meeting-header-th meeting-row" scope="col"></th>
                                                </tr>
                                            </thead>
                                            <tbody>

                                                <tr v-for="(meeting, index) in upcoming_meetings.meetings">
                                                    <th class="meeting-row" scope="row">{{index + 1}}</th>
                                                    <td class="meeting-row">{{meeting["start"]}}</td>
                                                    <td class="meeting-row">{{meeting["name"]}}</td>
                                                    <td class="meeting-row">{{meeting["organizer"]}}</td>
                                                    <td class="meeting-row">
                                                        <a v-bind:href="meeting.room_link" target="_blank"
                                                            class="btn btn-success">Join</a>
                                                        <button type="button" class="btn btn-info" data-toggle="modal"
                                                            v-bind:data-target="meeting.html_button_id">Generate
                                                            Invite</button>
                                                    </td>
                                                </tr>

                                            </tbody>
                                        </table>
                                    </div>
                                    <div v-else class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr class="table-primary">
                                                    <th class="meeting-header-th meeting-row" scope="col">#</th>
                                                    <th class="meeting-header-th meeting-row" scope="col">Start datetime
                                                    </th>
                                                    <th class="meeting-header-th meeting-row" scope="col">Meeting</th>
                                                    <th class="meeting-header-th meeting-row" scope="col">Organizer</th>
                                                    <th class="meeting-header-th meeting-row" scope="col"></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td colspan="5" class="text-center meeting-row">You do not have any
                                                        upcoming meetings.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="pills-past" role="tabpanel"
                                    aria-labelledby="pills-past-tab">

                                    <div v-if="past_meetings.show" class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr class="table-primary">
                                                    <th class="meeting-header-th meeting-row" scope="col">#</th>
                                                    <th class="meeting-header-th meeting-row" scope="col">Start datetime
                                                    </th>
                                                    <th class="meeting-header-th meeting-row" scope="col">End datetime
                                                    </th>
                                                    <th class="meeting-header-th meeting-row" scope="col">Meeting</th>
                                                    <th class="meeting-header-th meeting-row" scope="col">Organizer</th>
                                                </tr>
                                            </thead>
                                            <tbody>

                                                <tr v-for="(meeting, index) in past_meetings.meetings">
                                                    <th class="meeting-row" scope="row">{{index + 1}}</th>
                                                    <td class="meeting-row">{{meeting["start"]}}</td>
                                                    <td class="meeting-row">{{meeting["end"]}}</td>
                                                    <td class="meeting-row">{{meeting["name"]}}</td>
                                                    <td class="meeting-row">{{meeting["organizer"]}}</td>
                                                </tr>

                                            </tbody>
                                        </table>
                                    </div>
                                    <div v-else class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr class="table-primary">
                                                    <th class="meeting-header-th meeting-row" scope="col">#</th>
                                                    <th class="meeting-header-th meeting-row" scope="col">Start datetime
                                                    </th>
                                                    <th class="meeting-header-th meeting-row" scope="col">End datetime
                                                    </th>
                                                    <th class="meeting-header-th meeting-row" scope="col">Meeting</th>
                                                    <th class="meeting-header-th meeting-row" scope="col">Organizer</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td colspan="5" class="text-center meeting-row">You do not have any
                                                        past meetings.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generate meeting invite modals -->
                <div v-for="(meeting, index) in upcoming_meetings.meetings">
                    <div class="modal fade" v-bind:id="meeting.html_modal_id" tabindex="-1" role="dialog"
                        aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Copy Meeting Invite</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    Meeting Invite <br>
                                    <textarea readonly v-bind:id="meeting.html_textarea_id"
                                        style="width: 100%; padding: 10px;"
                                        rows="8">{{meeting["organizer"]}} would like to invite you to a scheduled video meeting. &#13;&#10;&#13;&#10;Topic: {{meeting["name"]}}&#13;&#10;Start Time: {{meeting["start"]}}&#13;&#10;End Time: Time: {{meeting["end"]}}&#13;&#10;&#13;&#10;Join Daily.co meeting:&#13;&#10;{{meeting["room_link"]}}</textarea>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" v-on:click="copyInvite(meeting.html_textarea_id)"
                                        class="btn btn-primary">Copy Message Invite</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Snackbar -->
                <div id="snackbar">Copied to clipboard!</div>

            </div>

        </div>
    </div>


    <script type="text/javascript" src="http://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
        </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous">
        </script>
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.3.2/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.3.2/locales-all.min.js"></script>
    <script src='https://unpkg.com/popper.js/dist/umd/popper.min.js'></script>
    <script src='https://unpkg.com/tooltip.js/dist/umd/tooltip.min.js'></script>
    <script>
        var app = new Vue({
            el: '#tasks',
            data: {
                taskView: "Gantt",
                nextView: "Meeting",
                viewKey: 0,
                user: {
                    // loggedInUser: "naruto@wad2.co",
                    loggedInUser: "",
                    userLevel: "",
                    userExp: "",
                },
                guild: {
                    // name: "wad2_guild",
                    name: "",
                    streak: "",
                    users: [],
                    reponame: ""
                },
                tasks: {
                    tasks: [],
                    taskName: "",
                    assignedTo: [],
                    start: "",
                    end: "",
                    dependency: "",
                    priority: "",
                    category: "",
                    status: ""
                },
                chosenTask: {
                    id: "",
                    taskName: "",
                    assignedTo: [],
                    start: "",
                    end: "",
                    dependency: "",
                    priority: "",
                    category: "",
                    status: ""
                },
                meeting: {
                    name: "",
                    attendees: [],
                    start: "",
                    end: "",
                },
                meeting_flag: false,
                upcoming_meetings: {
                    show: true,
                    meetings: []
                },
                past_meetings: {
                    show: true,
                    meetings: []
                },
            },
            methods: {
                openCompleteTaskModal: function () {
                    $("#attackModal").modal("show")
                },
                loadGantt: function () {
                    google.charts.load('current', {
                        'packages': ['gantt']
                    });
                    google.charts.setOnLoadCallback(this.drawChart);
                },
                loadCalendar: function () {
                    event_list = []

                    for (const task of this.tasks.tasks) {
                        var e = {}
                        e["id"] = task["id"]
                        e["title"] = task["name"]
                        e["start"] = new Date(task["start"]).toISOString().substr(0, 19)

                        event_list.push(e)
                    }

                    var calendarEl = document.getElementById('calendar_div');
                    var calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: $(window).width() < 514 ? 'listWeek' : 'dayGridMonth',
                        events: event_list,
                        eventTextColor: "black",
                        themeSystem: "bootstrap",
                        windowResize: function (arg) {
                            if ($(window).width() < 514) {
                                console.log(arg.view.type)
                                calendar.changeView('listWeek');
                            } else {
                                calendar.changeView('dayGridMonth');
                            }
                        }

                    });

                    calendar.render();

                },
                completeTask: function () {
                    // fetch("http://localhost:5001/complete_task", {
                    //     method: "POST",
                    //     headers: {
                    //         "Content-Type": "application/json"
                    //     },
                    //     body: JSON.stringify({
                    //         id: this.chosenTask.id,
                    //         email: this.user.loggedInUser
                    //     })
                    // }).then(res => {

                    //     res.json().then(data => {
                    //         console.log(data["new_exp"])
                    //         console.log(typeof data["new_exp"])
                    //         this.user.userExp = parseInt(data["new_exp"])
                    //         this.user.userLevel = parseInt(data["new_level"])
                    //         location.reload()
                    //     })

                    // })
                },
                modifyTask: function () {
                    fetch("http://localhost:5001/modify_task", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            id: this.chosenTask.id,
                            dependency: this.chosenTask.dependency,
                            assignedTo: this.chosenTask.assignedTo,
                            start: this.chosenTask.start,
                            end: this.chosenTask.end,
                            priority: this.chosenTask.priority,
                            category: this.chosenTask.category,
                            name: this.chosenTask.taskName,
                            guild: this.chosenTask.guild
                        })
                    }).then(res => {
                        location.reload()
                    })
                },
                addTask: function () {
                    fetch("http://localhost:5001/add_task", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            dependency: this.tasks.dependency,
                            assignedTo: this.tasks.assignedTo,
                            start: this.tasks.start,
                            end: this.tasks.end,
                            priority: this.tasks.priority,
                            category: this.tasks.category,
                            name: this.tasks.taskName,
                            guild: this.tasks.guild
                        })
                    }).then(res => {
                        console.log(res.json())
                        // location.reload()
                    })
                },
                addMeeting: function () {

                    fetch("http://localhost:5001/add_meeting", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            attendees: this.meeting.attendees,
                            start: this.meeting.start,
                            end: this.meeting.end,
                            name: this.meeting.name,
                            organizer: this.user.loggedInUser,
                        })
                    })
                        .then(response => response.json())
                        .then(data => {
                            var request = new XMLHttpRequest();

                            var meeting_id = data.id.split("-")[-1]

                            var params = {
                                "properties": {
                                    "enable_screenshare": true,
                                    "enable_chat": true,
                                    "start_video_off": true,
                                    "start_audio_off": true
                                },
                                "name": meeting_id
                            };

                            request.onreadystatechange = function () {
                                if (this.readyState == 4 && this.status == 200) {
                                    var responseText = JSON.parse(this.responseText);
                                    fetch("http://localhost:5001/modify_meeting", {
                                        method: "POST",
                                        headers: {
                                            "Content-Type": "application/json"
                                        },
                                        body: JSON.stringify({
                                            id: data.id,
                                            room_link: responseText.url
                                        })
                                    }).then(res => {
                                        location.reload()
                                    }).catch(e => {
                                        console.log(e);
                                    });
                                }
                            }

                            var url = "https://api.daily.co/v1/rooms";
                            request.open("POST", url, true);
                            request.setRequestHeader("Content-type",
                                "application/x-www-form-urlencoded");
                            request.setRequestHeader('Authorization',
                                'Bearer 014432e07e678d453d4faeb244e96c4f10932d71f82f8cf0376c0ddddbc5fab4'
                            );
                            request.send(JSON.stringify(params));
                        }).catch(e => {
                            console.log(e);
                        });

                },
                toggleView: function (view) {

                    if (view == "meetings") {
                        var meeting_flag = !this.meeting_flag;
                        this.meeting_flag = !this.meeting_flag;

                        if (meeting_flag) {
                            document.getElementById("gantt-chart").style.display = "none";
                            document.getElementById("calendar-col").style.display = "none";
                            document.getElementById("meeting-list").style.display = "block";

                            this.nextView = "Tasks"
                        } else {
                            document.getElementById("gantt-chart").style.display = "block";
                            document.getElementById("meeting-list").style.display = "none";
                            document.getElementById("calendar-col").style.display = "none";

                            this.nextView = "Meetings"

                        }
                    }

                },
                toggleTaskView: function () {

                    if (this.taskView == "Gantt") {
                        document.getElementById("meeting-list").style.display = "none";
                        document.getElementById("calendar-col").style.display = "block";
                        document.getElementById("gantt-chart").style.display = "none";

                        this.loadCalendar()

                        this.taskView = "Calendar"

                    } else if (this.taskView == "Calendar") {
                        document.getElementById("meeting-list").style.display = "none";
                        document.getElementById("calendar-col").style.display = "none";
                        document.getElementById("gantt-chart").style.display = "block";

                        this.taskView = "Gantt"
                    }

                },
                // Draws Gantt Chart
                drawChart: function () {
                    // Creates datatable to store info in gantt charts
                    var dataTable = new google.visualization.DataTable();
                    dataTable.addColumn('string', 'Task ID');
                    dataTable.addColumn('string', 'Task Name');
                    dataTable.addColumn('string', 'Resource');
                    dataTable.addColumn('date', 'Start');
                    dataTable.addColumn('date', 'End');
                    dataTable.addColumn('number', 'Duration');
                    dataTable.addColumn('number', '% Complete');
                    dataTable.addColumn('string', 'Dependencies');

                    // Transform task information to suitable format: [id, name, priority, start, end, duration, % complete (hard coded), dependency]
                    var tasks = this.tasks.tasks
                    var gantt_tasks = []
                    if (tasks !== undefined) {

                        var smallest = 100000000000000
                        var biggest = 0
                        tasks.forEach(task => {
                            var task_arr = [task["id"], task["name"], (task["status"]).toString(),
                            new Date(
                                task["start"]), new Date(task["end"]), null, 100, task[
                            "dependency"]
                            ]
                            gantt_tasks.push(task_arr)

                            var task_start = new Date(task["start"]).getTime() / 1000
                            if (task_start < smallest) {
                                smallest = task_start
                            }

                            var task_end = new Date(task["end"]).getTime() / 1000

                            if (task_end > biggest) {
                                biggest = task_end
                            }
                        });

                        // add data to data table
                        dataTable.addRows(gantt_tasks)

                        // options for gantt chart
                        var options = {
                            height: dataTable.getNumberOfRows() * 50,
                            width: (biggest - smallest) / 5000,
                            gantt: {
                                backgroundColor: "transparent",
                                arrow: {
                                    angle: 90,
                                    width: 5,
                                    radius: 0
                                },
                                innerGridTrack: {
                                    fill: '#FDE5B3'
                                },
                                innerGridDarkTrack: {
                                    fill: " #f3dba7"
                                },
                                innerGridHorizLine: {
                                    strokeWidth: 0
                                },
                                labelStyle: {
                                    fontName: "Helvetica",
                                    fontSize: 13
                                },
                                sortTasks: true,
                                criticalPathEnabled: true
                            }
                        };

                        // Create gantt chart
                        var chart = new google.visualization.Gantt(document.getElementById('gantt_div'));
                        var container = document.getElementById("gantt_div")

                        // When user selects task, open modify task popup
                        google.visualization.events.addListener(chart, "select", () => {
                            var select = chart.getSelection();
                            var task_id = dataTable.getValue(select[0].row, 0)

                            fetch("http://localhost:5001/get_task?id=" + task_id).then(res => {
                                var data = res.json().then(data => {
                                    console.log(data)
                                    console.log(task_id)

                                    this.chosenTask.taskName = data["name"]
                                    this.chosenTask.category = data["category"]
                                    this.chosenTask.start = new Date(data["start"])
                                        .toLocaleDateString()
                                    this.chosenTask.end = new Date(data["end"])
                                        .toLocaleDateString()
                                    this.chosenTask.priority = data["priority"]
                                    this.chosenTask.dependency = data["dependency"]
                                    this.chosenTask.assignedTo = data["assignedTo"]
                                    this.chosenTask.id = task_id
                                    this.chosenTask.status = data["status"]

                                    $('#modTaskModal').modal('show');

                                })
                            })

                        })

                        // Make tooltips invisible
                        google.visualization.events.addOneTimeListener(chart, 'ready', function () {
                            var observer = new MutationObserver(function (nodes) {
                                Array.prototype.forEach.call(nodes, function (node) {
                                    if (node.addedNodes.length > 0) {
                                        Array.prototype.forEach.call(node
                                            .addedNodes,
                                            function (addedNode) {
                                                if ((addedNode.tagName ===
                                                    'rect') && (addedNode
                                                        .getAttribute(
                                                            'fill') === 'white'
                                                    )) {
                                                    addedNode.setAttribute(
                                                        'fill',
                                                        'transparent');
                                                    addedNode.setAttribute(
                                                        'stroke',
                                                        'transparent');
                                                    Array.prototype.forEach
                                                        .call(addedNode
                                                            .parentNode
                                                            .getElementsByTagName(
                                                                'text'),
                                                            function (label) {
                                                                label
                                                                    .setAttribute(
                                                                        'fill',
                                                                        'transparent'
                                                                    );
                                                            });
                                                }
                                            });
                                    }
                                });
                            });
                            observer.observe(container, {
                                childList: true,
                                subtree: true
                            });
                        });

                        google.visualization.events.addListener(chart, "error", function (googleError) {
                            google.visualization.errors.removeError(googleError.id)
                        })

                        chart.draw(dataTable, options);
                    }

                },
                copyInvite: function (inviteId) {
                    var copyText = document.getElementById(inviteId);
                    copyText.select();
                    document.execCommand("copy");
                    //alert("Copied the text: " + copyText.value);
                    var x = document.getElementById("snackbar");
                    x.className = "show";
                    setTimeout(function () { x.className = x.className.replace("show", ""); }, 3000);
                },
                logout: function () {
                    sessionStorage.clear()
                    window.location.replace("./home.html");
                }
            },
            // When Vue view is created, runs the following functions
            async created() {

                if (sessionStorage.getItem("user") !== null) {
                    // Retrieve
                    this.user.loggedInUser = sessionStorage.getItem("user");
                    this.guild.name = sessionStorage.getItem("guildName");
                    this.tasks.guild = this.guild.name;
                } else {
                    window.location.replace("./login.html");
                }
                // Gets the information of the logged in user
                await fetch("http://localhost:5001/get_user?email=" + this.user.loggedInUser).then(res => {
                    var data = res.json().then(data => {
                        initialiseImage("../assets/" + data["class"] + "_spritesheet.png",
                            "#ch-img", 65, 260, 0, -70);
                        this.user.userLevel = data["level"];
                        this.user.userExp = data["exp"];
                        this.user.token = data["git_token"];
                    })
                })

                // Gets all users in the guild
                var resp = await fetch("http://localhost:5001/get_all_users").then(res => {
                    var data = res.json().then(data => {
                        var user_arr = []
                        for (u of data["users"]) {
                            user_arr.push([u["name"], u["email"], u["guild"]])
                        }
                        this.guild.users = user_arr
                        // console.log(this.guild.users)
                    })

                })

                // Gets all tasks in the guild to display in gantt chart
                await fetch("http://localhost:5001/get_all_tasks?guild=" + this.guild.name).then(res => {
                    var data = res.json().then(data => {
                        console.log(data)
                        this.tasks.tasks = data["tasks"]
                    })
                })


                // Gets guild info
                await fetch("http://localhost:5001/get_guild?name=" + this.guild.name).then(res => {
                    var data = res.json().then(data => {
                        this.guild.streak = data["streak"]
                        this.guild.reponame = data["r_name"]

                    })
                })



                // Initialises image of bad guys
                initialiseImage("../assets/demon_spritesheet.png", "#demon", 65, 170, 0, -20);
                initialiseImage("../assets/demon_spritesheet.png", "#demon2", 65, 170, 0, -20);
                initialiseAttackImage("../assets/attack_spritesheet.png", "#attack", 0.3, 550, 450, 0, 0);

                this.loadGantt()

                // Load their upcoming meetings
                await fetch("http://localhost:5001/get_upcoming_meetings?email=" + this.user.loggedInUser)
                    .then(res => {
                        var data = res.json().then(data => {
                            if (data["meetings"].length == 0) {
                                this.upcoming_meetings.show = false;
                            } else {
                                this.upcoming_meetings.show = true;
                                for (i = 0; i < data["meetings"].length; i++) {
                                    var new_start = data["meetings"][i]["start"].split(" ")
                                        .slice(0, -1).join(" ");
                                    var new_end = data["meetings"][i]["end"].split(" ").slice(0,
                                        -1).join(" ");

                                    data["meetings"][i]["start"] = new_start;
                                    data["meetings"][i]["end"] = new_end;
                                }
                                this.upcoming_meetings.meetings = data["meetings"];
                            }
                        })
                    });

                // Load their past meetings
                await fetch("http://localhost:5001/get_past_meetings?email=" + this.user.loggedInUser)
                    .then(res => {
                        var data = res.json().then(data => {
                            if (data["meetings"].length == 0) {
                                this.past_meetings.show = false;
                            } else {
                                this.past_meetings.show = true;
                                for (i = 0; i < data["meetings"].length; i++) {
                                    var new_start = data["meetings"][i]["start"].split(" ")
                                        .slice(0, -1).join(" ");
                                    var new_end = data["meetings"][i]["end"].split(" ").slice(0,
                                        -1).join(" ");

                                    data["meetings"][i]["start"] = new_start;
                                    data["meetings"][i]["end"] = new_end;
                                }
                                this.past_meetings.meetings = data["meetings"];
                            }
                        })
                    })


            }




        });


        // Datepicker add on 
        // $(document).ready(function () {
        //     var date_input = $('input[name="date"]'); //our date input has the name "date"
        //     var container = $('.modal-body form').length > 0 ? $('.modal-body form').parent() : "body";
        //     var options = {
        //         format: 'mm/dd/yyyy',
        //         container: container,
        //         todayHighlight: true,
        //         autoclose: true,
        //     };
        //     date_input.datepicker(options);
        // })

        // Initialise running images
        function initialiseImage(src, query, width, height, x, y) {
            // Create image object
            let img = new Image();
            img.src = src;
            img.onload = function () {
                init();
            };

            // Create canvas and context
            let canvas = document.querySelector(query);
            let ctx = canvas.getContext('2d');

            // set size of image
            const scale = 2.5;
            const scaledWidth = scale * width;
            const scaledHeight = scale * height;

            // Function for Initial state of image
            function init() {
                ctx.drawImage(img, 0, 0, width, height, x, y, scaledWidth, scaledHeight);
            }

            // Function to draw new images based on inputs
            function drawFrame(frameX, frameY, canvasX, canvasY) {
                ctx.drawImage(img, frameX * width, 0, width, height, x, y, scaledWidth, scaledHeight);
            }

            const cycleLoop = [0, 1, 2, 3];
            let currentLoopIndex = 0;
            let frameCount = 0;

            // Request next frame based on cycleloop
            window.requestAnimationFrame(step);

            // Clears old frame and replaces with new frame based on new values
            function step() {
                frameCount++;
                if (frameCount < 15) {
                    window.requestAnimationFrame(step);
                    return;
                }
                frameCount = 0;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawFrame(cycleLoop[currentLoopIndex], 0, 0, 0);
                currentLoopIndex++;
                if (currentLoopIndex >= cycleLoop.length) {
                    currentLoopIndex = 0;
                }
                window.requestAnimationFrame(step);
            }
        }
        function initialiseAttackImage(src, query, scale, width, height, x, y) {
            // Create image object
            let img = new Image();
            img.src = src;
            img.onload = function () {
                init();
            };

            // Create canvas and context
            let canvas = document.querySelector(query);
            let ctx = canvas.getContext('2d');

            // set size of image
            const scaledWidth = scale * width;
            const scaledHeight = scale * height;

            // Function for Initial state of image
            function init() {
                ctx.drawImage(img, 0, 0, width, height, x, y, scaledWidth, scaledHeight);
            }

            // Function to draw new images based on inputs
            function drawFrame(frameX, frameY, canvasX, canvasY) {
                ctx.drawImage(img, frameX * width, 0, width, height, x, y, scaledWidth, scaledHeight);
            }

            const cycleLoop = [0, 1, 2, 3];
            let currentLoopIndex = 0;
            let frameCount = 0;

            // Request next frame based on cycleloop
            window.requestAnimationFrame(step);

            // Clears old frame and replaces with new frame based on new values
            function step() {
                frameCount++;
                if (frameCount < 15) {
                    window.requestAnimationFrame(step);
                    return;
                }
                frameCount = 0;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawFrame(cycleLoop[currentLoopIndex], 0, 0, 0);
                currentLoopIndex++;
                if (currentLoopIndex >= cycleLoop.length) {
                    currentLoopIndex = 0;
                }
                window.requestAnimationFrame(step);
            }
        }


    </script>
</body>

</html>