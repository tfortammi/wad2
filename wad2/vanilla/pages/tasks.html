<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" />
    <style>
        body {
            background-image: url("../assets/bg.jpg");
            background-size: cover;
            background-repeat: no-repeat;
        }

        #tasks {
            height: 100%;
            margin-bottom: 80px;
        }

        #exp {
            margin-top: -15px;
        }

        #lvl {
            margin-top: -15px;
        }

        #ch-container {
            width: 80%;
        }

        /* #ch-window {
            border: 5px solid #a8c582;
            background-image: url("../assets/ch-bg.png");
            background-size: 150px;
            height: 140px;
        }
         */

        /* .container {
            width: 160px;
            height: 91px;
        } */

        #ch-window {
            width: 100%;
            height: 100%;
            border: 5px solid #a8c582;
            background: url("../assets/ch-bg.png") repeat-x right center;
            background-size: 150px;
            -webkit-animation: displace 10s linear infinite;
            animation: displace 10s linear infinite;
        }

        @-webkit-keyframes displace {

            from {
                background-position: 200% center;
            }

            to {
                background-position: right center;
            }


        }

        @keyframes displace {
            from {
                background-position: 200% center;
            }

            to {
                background-position: right center;
            }
        }


        #ch-img {
            width: 100px;
            margin-top: 10px;
            margin-left: 10px;
        }

        #demon {
            width: 110px;
            margin-top: 10px;
            margin-left: 100px;
        }

        #lvl-container {
            width: 150px;
            padding: 0px;
        }

        #lvl-window {
            border: 5px solid #a8c582;
            border-right: none;
        }

        #sidebar {
            border: 5px solid #a8c582;
            border-right: none;
        }

        .sidebar-btn {
            margin: 5px 0px;
            width: 120px;
        }

        #gantt-chart {
            border: 5px solid #a8c582;
            height: 420px;
        }

        #chart_div {
            margin: 30px 0px;
            background: transparent;
            /* width: 700px; */
        }
    </style>
</head>

<body>

    <div id="tasks">

        <!-- MODIFY TASK MODAL-->
        <div class="modal fade" id="modTaskModal" tabindex="-1" role="dialog" aria-labelledby="modTaskModal" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Modify New Task</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Task Name</span>
                                </div>
                                <input v-model="chosenTask.taskName" type="text" class="form-control" placeholder="Name"
                                    aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Category</span>
                                </div>
                                <input v-model="chosenTask.category" type="text" class="form-control" placeholder="Name"
                                    aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Start Date</span>
                                </div>
                                <input v-model="chosenTask.start" type="text" class="form-control" id="date" name="date"
                                    placeholder="MM/DD/YYY" aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">End Date</span>
                                </div>
                                <input v-model="chosenTask.end" type="text" class="form-control" id="date" name="date"
                                    placeholder="MM/DD/YYY" aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Priority</label>
                                </div>
                                <select v-model="chosenTask.priority" class="custom-select" id="inputGroupSelect01">
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Assigned To</label>
                                </div>
                                <select v-model="chosenTask.assignedTo" class="custom-select" multiple id="inputGroupSelect01">
                                    <option v-for="user in guild.users" v-bind:id="user[1]" v-bind:value="user[1]">{{user[0]}}</option>
                                </select>
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Dependency</span>
                                </div>
                                <select v-model="chosenTask.dependency" class="custom-select" id="inputGroupSelect01">
                                    <option v-for="task in tasks.tasks" v-bind:id="task['id']" v-bind:value="task['id']">{{task["name"]}} [{{new Date(task["end"]).toLocaleDateString()}}]</option>
                                </select>
                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" v-on:click="modifyTask" data-dismiss="modal">Save Changes</button>
                        <button type="button" class="btn btn-primary" v-on:click="completeTask" data-dismiss="modal">Complete Task</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADD TASK MODAL -->
        <div class="modal fade" id="taskModal" tabindex="-1" role="dialog" aria-labelledby="taskModal" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Create New Task</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Task Name</span>
                                </div>
                                <input v-model="tasks.taskName" type="text" class="form-control" placeholder="Name"
                                    aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Category</span>
                                </div>
                                <input v-model="tasks.category" type="text" class="form-control" placeholder="Name"
                                    aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Start Date</span>
                                </div>
                                <input v-model="tasks.start" type="text" class="form-control" id="date" name="date"
                                    placeholder="MM/DD/YYY" aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">End Date</span>
                                </div>
                                <input v-model="tasks.end" type="text" class="form-control" id="date" name="date"
                                    placeholder="MM/DD/YYY" aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Priority</label>
                                </div>
                                <select v-model="tasks.priority" class="custom-select" id="inputGroupSelect01">
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Assigned To</label>
                                </div>
                                <select v-model="tasks.assignedTo" class="custom-select" multiple id="inputGroupSelect01">
                                    <option v-for="user in guild.users" v-bind:id="user[1]">{{user[0]}}</option>
                                </select>
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Dependency</span>
                                </div>
                                <select v-model="tasks.dependency" class="custom-select" id="inputGroupSelect01">
                                    <option v-for="task in tasks.tasks" v-bind:id="task['id']">{{task["name"]}} [{{new Date(task["end"]).toLocaleDateString()}}]</option>
                                </select>
                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" v-on:click="addTask" data-dismiss="modal">Save
                            changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADD MEETING MODAL -->
        <div class="modal fade" id="meetingModal" tabindex="-1" role="dialog" aria-labelledby="meetingModal"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Create New Meeting</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Meeting Name</span>
                                </div>
                                <input type="text" class="form-control" placeholder="Name" aria-label="Username"
                                    aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Start Date</span>
                                </div>
                                <input type="text" class="form-control" id="date" name="date" placeholder="MM/DD/YYY"
                                    aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">Start Time</span>
                                </div>
                                <input type="text" class="form-control" id="date" name="date" placeholder="MM/DD/YYY"
                                    aria-label="Username" aria-describedby="basic-addon1">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <label class="input-group-text" for="inputGroupSelect01">Attendees</label>
                                </div>
                                <select class="custom-select" multiple id="inputGroupSelect01">
                                    <option selected>None</option>
                                    <option value="1">One</option>
                                    <option value="2">Two</option>
                                    <option value="3">Three</option>
                                </select>
                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- NAVBAR -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="#">WAD</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item ">
                        <a class="nav-link" href="./home.html">Home </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link active" href="./tasks.html">Tasks </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="./team.html">Team <span class="sr-only">(current)</span></a>
                    </li>
                </ul>
                <ul class='navbar-nav ml-auto'>
                    <li class="nav-item m-1">
                        <a class="btn btn-secondary" href="./createguildorg.html">Create Guild</a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- MAIN CONTENT -->
        <div class="container" style="height: 100%;">
            <br>

            <div class="row justify-content-md-center">
                <!-- CHARACTER INFO CONTAINER -->
                <div class="col-2 text-center py-3" id="lvl-window">
                    <h5 >Streak: {{guild.streak}} days</h5>
                    <h1 id="lvl" class="font-weight-bold">Lvl: {{user.userLevel}}</h1>
                    <h4 id="exp">EXP: {{user.userExp}}</h4>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" v-bind:style="{width: user.userExp + '%'}"
                            v-bind:aria-valuenow="user.userExp" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <!-- CHARACTER RUNNING CONTAINER -->
                <div class="col-10 p-0">
                    <div class="col" id="ch-window">
                        <canvas id="ch-img" width="150" height="150"></canvas>
                        <canvas id="demon" width="150" height="150"></canvas>
                    </div>
                </div>
            </div>
            <br>

            <div class="row justify-content-md-center">
                <!-- BUTTON SIDEBAR -->
                <div class="col-2 py-3 text-center" id="sidebar">
                    <button class="btn btn-primary sidebar-btn shadow-sm" data-target="#taskModal" data-toggle="modal">Add
                        Task</button>
                    <button class="btn btn-primary sidebar-btn shadow-sm" data-target="#meetingModal"
                        data-toggle="modal">Add Meeting</button>
                </div>
                <!-- GANTT CHART -->
                <div class="col-10" id="gantt-chart" style="overflow: scroll;">
                    <div class="container">
                        <div class="row">
                            <div class="col text-center mt-2">
                                <div id="chart_div"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <script type="text/javascript" src="http://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <script>

        var app = new Vue({
            el: '#tasks',
            data: {
                user: {
                    loggedInUser: "naruto@wad2.co",
                    userLevel: "",
                    userExp: "",
                },
                guild: {
                    name: "wad2_guild",
                    streak: "",
                    users: []
                },
                tasks: {
                    tasks: [],
                    taskName: "",
                    assignedTo: [],
                    start: "",
                    end: "",
                    dependency: "",
                    priority: "",
                    category: ""
                },
                chosenTask: {
                    id: "",
                    taskName: "",
                    assignedTo: [],
                    start: "",
                    end: "",
                    dependency: "",
                    priority: "",
                    category: ""
                }
                
            },
            methods: {
                completeTask: function() {
                    fetch("http://localhost:5001/complete_task", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            id: this.chosenTask.id
                        })
                    }).then(res => {
                        location.reload()
                    })
                },
                modifyTask: function () {
                    fetch("http://localhost:5001/modify_task", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            id: this.chosenTask.id,
                            dependency: this.chosenTask.dependency,
                            assignedTo: this.chosenTask.assignedTo,
                            start: this.chosenTask.start,
                            end: this.chosenTask.end,
                            priority: this.chosenTask.priority,
                            category: this.chosenTask.category,
                            name: this.chosenTask.taskName,
                            guild: this.chosenTask.guild
                        })
                    }).then(res => {
                        location.reload()
                    })
                },
                addTask: function () {
                    fetch("http://localhost:5001/add_task", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            dependency: this.tasks.dependency,
                            assignedTo: this.tasks.assignedTo,
                            start: this.tasks.start,
                            end: this.tasks.end,
                            priority: this.tasks.priority,
                            category: this.tasks.category,
                            name: this.tasks.taskName,
                            guild: this.tasks.guild
                        })
                    }).then(res => {
                        location.reload()
                    })
                },
                // Draws Gantt Chart
                drawChart: function () {
                    // Creates datatable to store info in gantt charts
                    var dataTable = new google.visualization.DataTable();
                    dataTable.addColumn('string', 'Task ID');
                    dataTable.addColumn('string', 'Task Name');
                    dataTable.addColumn('string', 'Resource');
                    dataTable.addColumn('date', 'Start');
                    dataTable.addColumn('date', 'End');
                    dataTable.addColumn('number', 'Duration');
                    dataTable.addColumn('number', '% Complete');
                    dataTable.addColumn('string', 'Dependencies');

                    // Transform task information to suitable format: [id, name, priority, start, end, duration, % complete (hard coded), dependency]
                    var tasks = this.tasks.tasks
                    var gantt_tasks = []
                    if (tasks !== undefined) {
                        tasks.forEach(task => {
                            var task_arr = [task["id"], task["name"], task["priority"], new Date(task["start"]), new Date(task["end"]), null, 100, task["dependency"]]
                            gantt_tasks.push(task_arr)
                        });

                        // add data to data table
                        dataTable.addRows(gantt_tasks)

                        // options for gantt chart
                        var options = {
                            height: dataTable.getNumberOfRows() * 50,
                            gantt: {
                                backgroundColor: "transparent",
                                arrow: {
                                    angle: 90,
                                    width: 5,
                                    radius: 0
                                },
                                innerGridTrack: { fill: '#FDE5B3' },
                                innerGridDarkTrack: { fill: " #f3dba7" },
                                innerGridHorizLine: {
                                    strokeWidth: 0
                                },
                                labelStyle: {
                                    fontName: "VT323",
                                    fontSize: 17
                                },
                                sortTasks: true,
                                criticalPathEnabled: true
                            }
                        };

                        // Create gantt chart
                        var chart = new google.visualization.Gantt(document.getElementById('chart_div'));
                        var container = document.getElementById("chart_div")
                        
                        // When user selects task, open modify task popup
                        google.visualization.events.addListener(chart, "select", () => {
                            var select = chart.getSelection();
                            var task_id = dataTable.getValue(select[0].row, 0)

                            fetch("http://localhost:5001/get_task?id=" + task_id).then(res => {
                                var data = res.json().then(data => {
                                    console.log(data)
                                    console.log(task_id)
                                    
                                    this.chosenTask.taskName = data["name"]
                                    this.chosenTask.category = data["category"]
                                    this.chosenTask.start = new Date(data["start"]).toLocaleDateString()
                                    this.chosenTask.end = new Date(data["end"]).toLocaleDateString()
                                    this.chosenTask.priority = data["priority"]
                                    this.chosenTask.dependency = data["dependency"]
                                    this.chosenTask.assignedTo = data["assignedTo"]
                                    this.chosenTask.id = task_id

                                    $('#modTaskModal').modal('show');

                                })
                            })

                        })
                        
                        // Make tooltips invisible
                        google.visualization.events.addOneTimeListener(chart, 'ready', function () {
                            var observer = new MutationObserver(function (nodes) {
                                Array.prototype.forEach.call(nodes, function (node) {
                                    if (node.addedNodes.length > 0) {
                                        Array.prototype.forEach.call(node.addedNodes, function (addedNode) {
                                            if ((addedNode.tagName === 'rect') && (addedNode.getAttribute('fill') === 'white')) {
                                                addedNode.setAttribute('fill', 'transparent');
                                                addedNode.setAttribute('stroke', 'transparent');
                                                Array.prototype.forEach.call(addedNode.parentNode.getElementsByTagName('text'), function (label) {
                                                    label.setAttribute('fill', 'transparent');
                                                });
                                            }
                                        });
                                    }
                                });
                            });
                            observer.observe(container, {
                                childList: true,
                                subtree: true
                            });
                        });

                        chart.draw(dataTable, options);
                    }

                }

            },
            // When Vue view is created, runs the following functions
            async created() {
                // Gets all users in the guild
                var resp = await fetch("http://localhost:5001/get_all_users").then(res => {
                    var data = res.json().then(data => {
                        var user_arr = []
                        for (u of data["users"]) {
                            user_arr.push([u["name"], u["email"]])
                        }
                        this.guild.users = user_arr
                    })

                })

                // Gets all tasks in the guild to display in gantt chart
                await fetch("http://localhost:5001/get_all_tasks?guild=wad2_guild").then(res => {
                    var data = res.json().then(data => {
                        this.tasks.tasks = data["tasks"]
                    }
                    )
                })

                // Gets the information of the logged in user
                await fetch("http://localhost:5001/get_user?email=" + this.user.loggedInUser).then(res => {
                    var data = res.json().then(data => {
                        initialiseImage("../assets/" + data["class"] + "_spritesheet.png", "#ch-img", 65, 260, 0, -70);
                        this.user.userLevel = data["level"]
                        this.user.userExp = data["exp"]
                    }
                    )
                })

                // Gets guild info
                await fetch("http://localhost:5001/get_guild?name=" + this.guild.name).then(res => {
                    var data = res.json().then(data => {
                        this.guild.streak = data["streak"]
                        }
                    )
                })


                // Loads gantt chart
                google.charts.load('current', { 'packages': ['gantt'] });
                google.charts.setOnLoadCallback(this.drawChart);

                // Initialises image of bad guys
                initialiseImage("../assets/demon_spritesheet.png", "#demon", 65, 170, 0, -20);


            }

        });






        // Datepicker add on 
        // $(document).ready(function () {
        //     var date_input = $('input[name="date"]'); //our date input has the name "date"
        //     var container = $('.modal-body form').length > 0 ? $('.modal-body form').parent() : "body";
        //     var options = {
        //         format: 'mm/dd/yyyy',
        //         container: container,
        //         todayHighlight: true,
        //         autoclose: true,
        //     };
        //     date_input.datepicker(options);
        // })

        // Initialise running images
        function initialiseImage(src, query, width, height, x, y) {
            // Create image object
            let img = new Image();
            img.src = src;
            img.onload = function () {
                init();
            };

            // Create canvas and context
            let canvas = document.querySelector(query);
            let ctx = canvas.getContext('2d');

            // set size of image
            const scale = 2.5;
            const scaledWidth = scale * width;
            const scaledHeight = scale * height;

            // Function for Initial state of image
            function init() {
                ctx.drawImage(img, 0, 0, width, height, x, y, scaledWidth, scaledHeight);
            }

            // Function to draw new images based on inputs
            function drawFrame(frameX, frameY, canvasX, canvasY) {
                ctx.drawImage(img, frameX * width, 0, width, height, x, y, scaledWidth, scaledHeight);
            }

            const cycleLoop = [0, 1, 2, 3];
            let currentLoopIndex = 0;
            let frameCount = 0;

            // Request next frame based on cycleloop
            window.requestAnimationFrame(step);

            // Clears old frame and replaces with new frame based on new values
            function step() {
                frameCount++;
                if (frameCount < 15) {
                    window.requestAnimationFrame(step);
                    return;
                }
                frameCount = 0;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawFrame(cycleLoop[currentLoopIndex], 0, 0, 0);
                currentLoopIndex++;
                if (currentLoopIndex >= cycleLoop.length) {
                    currentLoopIndex = 0;
                }
                window.requestAnimationFrame(step);
            }
        }



    </script>
</body>

</html>