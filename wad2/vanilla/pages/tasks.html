<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" />
    <style>
        body {
            background-image: url("../assets/bg.jpg");
            background-size: cover;
            background-repeat: no-repeat;
        }

        #tasks {
            height: 100%;
            margin-bottom: 80px;
        }

        #exp {
            margin-top: -15px;
        }

        #ch-container {
            width: 80%;
        }

        /* #ch-window {
            border: 5px solid #a8c582;
            background-image: url("../assets/ch-bg.png");
            background-size: 150px;
            height: 140px;
        }
         */

        /* .container {
            width: 160px;
            height: 91px;
        } */

        #ch-window {
            width: 100%;
            height: 100%;
            border: 5px solid #a8c582;
            background: url("../assets/ch-bg.png") repeat-x right center;
            background-size: 150px;
            -webkit-animation: displace 10s linear infinite;
            animation: displace 10s linear infinite;
        }

        @-webkit-keyframes displace {

            from {
                background-position: 200% center;
            }
            to {
                background-position: right center;
            }

            
        }

        @keyframes displace {
            from {
                background-position: 200% center;
            }

            to {
                background-position: right center;
            }
        }


        #ch-img {
            width: 100px;
            margin-top: 10px;
            margin-left: 10px;
        }

        #demon {
            width: 110px;
            margin-top: 10px;
            margin-left: 100px;
        }

        #lvl-container {
            width: 150px;
            padding: 0px;
        }

        #lvl-window {
            border: 5px solid #a8c582;
            border-right: none;
        }

        #sidebar {
            border: 5px solid #a8c582;
            border-right: none;
        }

        .sidebar-btn {
            margin: 5px 0px;
            width: 120px;
        }

        #gantt-chart {
            border: 5px solid #a8c582;
            height: 420px;
        }

        #chart_div {
            margin: 30px 0px;
            background: transparent;
            /* width: 700px; */
        }
    </style>
</head>

<body>

    <div class="modal fade" id="taskModal" tabindex="-1" role="dialog" aria-labelledby="taskModal" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskModal">Create New Task</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- name, start, end, percentdone, dependencies -->
                    <form>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Task Name</span>
                            </div>
                            <input type="text" class="form-control" placeholder="Name" aria-label="Username"
                                aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Assigned To</span>
                            </div>
                            <input type="text" class="form-control" placeholder="Name" aria-label="Username"
                                aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Start Date</span>
                            </div>
                            <input type="text" class="form-control" id="date" name="date" placeholder="MM/DD/YYY"
                                aria-label="Username" aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">End Date</span>
                            </div>
                            <input type="text" class="form-control" id="date" name="date" placeholder="MM/DD/YYY"
                                aria-label="Username" aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupSelect01">Dependencies</label>
                            </div>
                            <select class="custom-select" multiple id="inputGroupSelect01">
                                <option selected>None</option>
                                <option value="1">One</option>
                                <option value="2">Two</option>
                                <option value="3">Three</option>
                            </select>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="meetingModal" tabindex="-1" role="dialog" aria-labelledby="meetingModal"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskModal">Create New Meeting</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Meeting Name</span>
                            </div>
                            <input type="text" class="form-control" placeholder="Name" aria-label="Username"
                                aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Start Date</span>
                            </div>
                            <input type="text" class="form-control" id="date" name="date" placeholder="MM/DD/YYY"
                                aria-label="Username" aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Start Time</span>
                            </div>
                            <input type="text" class="form-control" id="date" name="date" placeholder="MM/DD/YYY"
                                aria-label="Username" aria-describedby="basic-addon1">
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" for="inputGroupSelect01">Attendees</label>
                            </div>
                            <select class="custom-select" multiple id="inputGroupSelect01">
                                <option selected>None</option>
                                <option value="1">One</option>
                                <option value="2">Two</option>
                                <option value="3">Three</option>
                            </select>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">WAD</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item ">
                    <a class="nav-link" href="./home.html">Home </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link active" href="./tasks.html">Tasks </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="./team.html">Team <span class="sr-only">(current)</span></a>
                </li>
            </ul>
            <ul class='navbar-nav ml-auto'>
                <li class="nav-item">
                    <a class="btn btn-secondary" href="./createguild.html">Create Guild</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container" id="tasks" style="height: 100%;">
        <br>

        <div class="row justify-content-md-center">
            <div class="col-2 text-center py-3" id="lvl-window">
                <h1 class="font-weight-bold">Lvl: 20</h1>
                <h4 id="exp">EXP: 300</h4>
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0"
                        aria-valuemax="100"></div>
                </div>
            </div>
            <div class="col-10 p-0">
                <div class="col" id="ch-window">
                    <canvas id="ch-img" width="150" height="150"></canvas>
                    <canvas id="demon" width="150" height="150"></canvas>
                    <!-- <img id="ch-img" src="../assets/knight.png"> -->
                </div>
            </div>
        </div>
        <br>

        <div class="row justify-content-md-center">
            <div class="col-2 py-3 text-center" id="sidebar">
                <button class="btn btn-primary sidebar-btn shadow-sm" data-target="#taskModal" data-toggle="modal">Add
                    Task</button>
                <button class="btn btn-primary sidebar-btn shadow-sm" data-target="#meetingModal"
                    data-toggle="modal">Add Meeting</button>
            </div>
            <div class="col-10" id="gantt-chart">
                <div class="container">
                    <div class="row">
                        <div class="col text-center mt-2" style="overflow: scroll;">
                            <div id="chart_div"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <script>

        google.charts.load('current', { 'packages': ['gantt'] });
        google.charts.setOnLoadCallback(drawChart);

        function daysToMilliseconds(days) {
            return days * 24 * 60 * 60 * 1000;
        }

        function drawChart() {

            var otherData = new google.visualization.DataTable();
            otherData.addColumn('string', 'Task ID');
            otherData.addColumn('string', 'Task Name');
            otherData.addColumn('string', 'Resource');
            otherData.addColumn('date', 'Start');
            otherData.addColumn('date', 'End');
            otherData.addColumn('number', 'Duration');
            otherData.addColumn('number', 'Percent Complete');
            otherData.addColumn('string', 'Dependencies');

            otherData.addRows([
                ['toTrain', 'Task 1', 'walk', null, null, daysToMilliseconds(3), 100, null],
                ['music', 'Task 2', 'music', null, null, daysToMilliseconds(1), 42, null],
                ['wait', 'Task 3', 'wait', null, null, daysToMilliseconds(4), 100, 'toTrain'],
                ['train', 'Task 4', 'train', null, null, daysToMilliseconds(2), 75, 'wait'],
                ['toWork', 'Task 5', 'walk', null, null, daysToMilliseconds(0.5), 0, 'train'],
                ['work', 'Task 6', null, null, null, daysToMilliseconds(1), 0, 'toWork'],

            ]);

            var options = {
                height: otherData.getNumberOfRows() * 53,
                gantt: {
                    defaultStartDateMillis: new Date(2015, 3, 28),
                    backgroundColor: "transparent",
                    arrow: {
                        angle: 100,
                        width: 5,
                        radius: 0
                    },
                    innerGridTrack: { fill: '#FDE5B3' },
                    innerGridDarkTrack: { fill: " #f3dba7" },
                    innerGridHorizLine: {
                        strokeWidth: 0
                    },
                    labelStyle: {
                        fontName: "VT323",
                        fontSize: 17
                    },
                    shadowEnabled: false,
                    shadowOffset: 4,
                    sortTasks: true,

                }
            };

            var chart = new google.visualization.Gantt(document.getElementById('chart_div'));

            chart.draw(otherData, options);
        }

        $(document).ready(function () {
            var date_input = $('input[name="date"]'); //our date input has the name "date"
            var container = $('.modal-body form').length > 0 ? $('.modal-body form').parent() : "body";
            var options = {
                format: 'mm/dd/yyyy',
                container: container,
                todayHighlight: true,
                autoclose: true,
                orientation: "top"
            };
            date_input.datepicker(options);
        })

        var app = new Vue(
            {
                el: "#tasks",
                methods: {

                }
            }
        );


        function initialiseImage(src, query, width, height, x, y) {
            let img = new Image();
            img.src = src;
            img.onload = function () {
                init();
            };

            let canvas = document.querySelector(query);
            let ctx = canvas.getContext('2d');

            const scale = 2.5;
            const scaledWidth = scale * width;
            const scaledHeight = scale * height;
            function init() {
                ctx.drawImage(img, 0, 0, width, height, x, y, scaledWidth, scaledHeight);
            }

            function drawFrame(frameX, frameY, canvasX, canvasY) {
                ctx.drawImage(img, frameX * width, 0, width, height, x, y, scaledWidth, scaledHeight);
            }

            const cycleLoop = [0, 1, 2, 3];
            let currentLoopIndex = 0;
            let frameCount = 0;

            window.requestAnimationFrame(step);
            function step() {
                frameCount++;
                if (frameCount < 15) {
                    window.requestAnimationFrame(step);
                    return;
                }
                frameCount = 0;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawFrame(cycleLoop[currentLoopIndex], 0, 0, 0);
                currentLoopIndex++;
                if (currentLoopIndex >= cycleLoop.length) {
                    currentLoopIndex = 0;
                }
                window.requestAnimationFrame(step);
            }
        }

        initialiseImage("../assets/knight_spritesheet.png", "#ch-img", 65, 260, 0, -70);
        initialiseImage("../assets/demon_spritesheet.png", "#demon", 65, 170, 0, -20);


    </script>
</body>

</html>